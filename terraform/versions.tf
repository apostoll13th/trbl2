# =============================================================================
# versions.tf - Настройка Terraform и провайдеров
# =============================================================================
# Этот файл определяет:
# 1. Минимальную версию Terraform
# 2. Какие провайдеры (плагины) нужны для работы
# 3. Настройки подключения к VK Cloud
# =============================================================================

# -----------------------------------------------------------------------------
# Блок terraform {} - глобальные настройки Terraform
# -----------------------------------------------------------------------------
terraform {
  # Требуем Terraform версии 1.0.0 или выше
  # Почему: в версии 1.0 стабилизировался синтаксис и API
  required_version = ">= 1.0.0"

  # -----------------------------------------------------------------------------
  # required_providers - список провайдеров (плагинов) которые нужны
  # Провайдер = плагин который умеет работать с конкретным облаком/сервисом
  # -----------------------------------------------------------------------------
  required_providers {
    # Провайдер VK Cloud (бывший Mail.ru Cloud Solutions)
    vkcs = {
      # source - откуда скачивать провайдер
      # Формат: <namespace>/<name>, скачивается из registry.terraform.io
      source = "vk-cs/vkcs"

      # version - какую версию использовать
      # ~> 0.13.0 означает: >=0.13.0 и <0.14.0 (патч-версии разрешены)
      # Это защищает от breaking changes в новых минорных версиях
      version = "~> 0.13.0"
    }

    # Провайдер для работы с локальными файлами
    # Нужен чтобы генерировать Ansible inventory после создания VM
    local = {
      source  = "hashicorp/local"
      version = "~> 2.4"
    }
  }
}

# -----------------------------------------------------------------------------
# Блок provider "vkcs" - настройки подключения к VK Cloud
# -----------------------------------------------------------------------------
# Провайдер использует эти данные для аутентификации в API VK Cloud
# Все операции (создание VM, сетей и т.д.) выполняются через этот API
# -----------------------------------------------------------------------------
provider "vkcs" {
  # username - email от аккаунта VK Cloud
  username = var.vkcs_username

  # password - пароль от аккаунта VK Cloud
  password = var.vkcs_password

  # project_id - ID проекта (из настроек проекта -> API ключи)
  # Формат: hex-строка типа "a52e7c2e4d2a4f3abd1757471fa378f6"
  project_id = var.vkcs_project_id

  # region - регион VK Cloud
  region = var.vkcs_region

  # auth_url - endpoint аутентификации VK Cloud
  auth_url = "https://infra.mail.ru:35357/v3/"
}
